<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scavenger Hunt</title>

<style>
body{font-family:system-ui;background:#f4f6f8;padding:20px}
.card{max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:12px}
.hunt{border:1px solid #ddd;padding:12px;border-radius:8px;margin-bottom:12px}
button{margin:6px;padding:8px 14px}
input{width:100%;padding:8px;margin:6px 0}

.overlay{
  position:fixed;inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  font-size:28px;
  font-weight:bold;
  z-index:999;
}

.overlay.wrong{
  background:rgba(180,0,0,.75);
  color:#fff;
}

.overlay.correct{
  background:rgba(0,150,0,.75);
  color:#fff;
}

.print-page{page-break-after:always}
.qr-grid{display:grid;grid-template-columns:repeat(auto-fill,120px);gap:20px}
.qr-item{text-align:center;font-size:12px}

@media print{button{display:none}}
</style>
</head>

<body>
<div class="card" id="app"></div>

<div class="overlay wrong" id="wrongOverlay">‚ùå Wrong code ‚Äî try again</div>
<div class="overlay correct" id="correctOverlay">‚úÖ Correct! Moving on‚Ä¶</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
/* ---------- Utilities ---------- */
const genCode=()=>Math.floor(100000+Math.random()*900000).toString();

/* ---------- Base Hunts ---------- */
const BASE={
escape:{name:"Escape the House",steps:[
["I show your face but I‚Äôm not a photo.","mirror"],
["I have pages but no homework.","bookshelf"],
["I open wide but never talk.","fridge"],
["I go round and round.","washing machine"],
["I have hands but no arms.","clock"],
["I hide your feet.","shoe rack"],
["I steal naps.","couch"],
["I light the dark.","lamp"],
["You knock before opening.","bedroom door"],
["Final key location.","treasure spot"]
]},
fortnite:{name:"Fortnite IRL",steps:[
["Controllers sleep here.","gaming desk"],
["Drinks recharge HP.","fridge"],
["Shoes hide here.","entrance"],
["Tools live here.","garage"],
["Family chill zone.","lounge room"],
["Sleep to win.","bed"],
["Secrets behind doors.","wardrobe"],
["Devices recharge.","phone charger"],
["High ground wins.","stairs"],
["Battles are watched.","tv"],
["Snacks disappear.","pantry"],
["Victory location.","treasure spot"]
]},
hacker:{name:"System Breach",steps:[
["Controls all devices.","router"],
["Passwords written.","notebook"],
["Cold storage.","fridge"],
["Commands typed.","keyboard"],
["One click changes all.","mouse"],
["Power source.","power board"],
["Clothes reset.","laundry"],
["Backup location.","garage"],
["Pixels form reality.","monitor"],
["Permission required.","door"],
["Locked & hidden.","drawer"],
["Tracks time.","clock"],
["Operator rests.","bed"],
["Admin only.","desk"],
["Payload location.","treasure spot"]
]}
};

/* ---------- Storage Init ---------- */
let hunts=JSON.parse(localStorage.getItem("hunts")||"null");
if(!hunts){
  hunts={};
  for(const k in BASE){
    hunts[k]={
      name:BASE[k].name,
      clues:BASE[k].steps.map(s=>({
        clue:s[0],
        location:s[1],
        code:genCode()
      }))
    };
  }
  localStorage.setItem("hunts",JSON.stringify(hunts));
}

/* ---------- Router ---------- */
const q=new URLSearchParams(location.search);
const app=document.getElementById("app");

if(q.get("play")) play();
else if(q.get("start")) start();
else if(q.get("print")) printPage(q.get("print"));
else home();

/* ---------- Home ---------- */
function home(){
  app.innerHTML=`<h1>Scavenger Hunts</h1>
  ${Object.entries(hunts).map(([k,h])=>`
    <div class="hunt">
      <h3>${h.name}</h3>
      <button onclick="location='?start=${k}'">‚ñ∂ Start (Test)</button>
      <button onclick="location='?print=${k}'">üñ® Print Instructions</button>
    </div>`).join("")}`;
}

/* ---------- Start Page ---------- */
function start(){
  const k=q.get("start");
  const h=hunts[k];
  app.innerHTML=`
  <h2>üéâ Welcome to the ${h.name}!</h2>
  <p>
    You‚Äôve been invited on a scavenger hunt!  
    Hidden around the house are secret QR codes.  
    Find the right place, scan the code, and enter the number to unlock the next clue.
  </p>
  <p>Work together, think carefully, and most of all ‚Äî have fun!</p>
  <button onclick="location='?play=${k}&s=0'">üöÄ Start the Hunt</button>`;
}

/* ---------- Play ---------- */
function play(){
  const k=q.get("play");
  const h=hunts[k];
  const s=parseInt(q.get("s")||0);

  if(s>=h.clues.length){
    app.innerHTML=`<h2>üéâ Hunt Complete!</h2>`;
    return;
  }

  const c=h.clues[s];
  app.innerHTML=`
    <p>${c.clue}</p>
    <input id="ans" placeholder="Enter 6-digit code">
    <button onclick="check('${c.code}',${s},'${k}')">Submit</button>`;
}

/* ---------- Check ---------- */
function check(code,s,k){
  const val=document.getElementById("ans").value;
  if(val===code){
    correctOverlay.style.display="flex";
    setTimeout(()=>{
      correctOverlay.style.display="none";
      location=`?play=${k}&s=${s+1}`;
    },900);
  }else{
    wrongOverlay.style.display="flex";
    document.getElementById("ans").value="";
    setTimeout(()=>wrongOverlay.style.display="none",1200);
  }
}

/* ---------- Print ---------- */
function printPage(k){
  const h=hunts[k];
  app.innerHTML=`
  <div class="print-page">
    <h2>${h.name} ‚Äî Parent Instructions</h2>
    ${h.clues.map((c,i)=>`
      <p><strong>Clue ${i+1}:</strong> ${c.clue}</p>
      <p><strong>Hide QR at:</strong> ${c.location}</p>
      <p><strong>Unlock Code:</strong> ${c.code}</p>
      <div id="pqr${i}"></div>
      <p>Notes: ______________________________</p>
    `).join("")}
  </div>

  <div class="print-page">
    <h2>Cut-Out QR Codes</h2>
    <div class="qr-grid">
      ${h.clues.map((c,i)=>`
        <div class="qr-item">
          <div id="cqr${i}"></div>
          <div>${c.location}</div>
        </div>`).join("")}
    </div>
  </div>`;

  h.clues.forEach((c,i)=>{
    QRCode.toCanvas(document.getElementById("pqr"+i),c.code,{width:80});
    QRCode.toCanvas(document.getElementById("cqr"+i),c.code,{width:100});
  });
}
</script>
</body>
</html>
