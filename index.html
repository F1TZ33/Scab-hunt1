<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Scavenger Hunt</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
.card {
  max-width: 900px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 12px;
}
button {
  padding: 12px 18px;
  font-size: 18px;
  cursor: pointer;
}
.overlay {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 40px;
  font-weight: bold;
  color: white;
  z-index: 1000;
}
.overlay.wrong { background: rgba(200,0,0,0.85); }
.overlay.correct { background: rgba(0,160,0,0.85); }

.print-page {
  page-break-after: always;
}
.print-item {
  margin-bottom: 18px;
}
.notes {
  border: 1px dashed #aaa;
  height: 40px;
  margin-top: 6px;
}
.qr-label {
  font-weight: bold;
  margin-bottom: 6px;
}

@media print {
  button { display:none; }
}
</style>
</head>

<body>

<div class="card" id="app"></div>

<div id="wrong" class="overlay wrong">‚ùå Try Again</div>
<div id="correct" class="overlay correct">‚úÖ Correct!</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
/* ================== UTIL ================== */
function uid() {
  return Math.random().toString(36).slice(2,9);
}
function randomCode() {
  return Math.floor(100000 + Math.random()*900000).toString();
}

/* ================== BASE HUNTS ================== */
const BASE_HUNTS = [
{
  name:"Escape the House",
  clues:[
    ["I show your face but I‚Äôm not a photo.","Mirror"],
    ["I have pages but no homework.","Bookshelf"],
    ["I keep food cold.","Fridge"],
    ["I go round and round.","Washing Machine"],
    ["I have hands but no arms.","Clock"],
    ["I hide your shoes.","Shoe Rack"],
    ["I steal naps.","Couch"],
    ["I light the dark.","Lamp"],
    ["You knock before opening.","Bedroom Door"],
    ["Final prize location","Red Ribbon"]
  ]
},
{
  name:"Fortnite IRL",
  clues:[
    ["Controllers rest here.","Gaming Desk"],
    ["Drinks recharge HP.","Fridge"],
    ["Shoes hide here.","Entrance"],
    ["Tools live here.","Garage"],
    ["Family chill zone.","Lounge Room"],
    ["Sleep is key.","Bed"],
    ["Secrets behind doors.","Wardrobe"],
    ["Devices recharge.","Phone Charger"],
    ["High ground.","Stairs"],
    ["Battles are watched.","TV"],
    ["Snacks vanish here.","Pantry"],
    ["Victory reward","Silver Ribbon"]
  ]
},
{
  name:"System Breach",
  clues:[
    ["Controls the network.","Router"],
    ["Passwords written.","Notebook"],
    ["Cold data storage.","Fridge"],
    ["Commands typed.","Keyboard"],
    ["Single click.","Mouse"],
    ["Power source.","Power Board"],
    ["Clothes reset.","Laundry"],
    ["Backup location.","Garage"],
    ["Pixels form here.","Monitor"],
    ["Permission entry.","Door"],
    ["Hidden storage.","Drawer"],
    ["Tracks time.","Clock"],
    ["Operator rests.","Bed"],
    ["Admin access.","Desk"],
    ["Payload retrieved","Green Ribbon"]
  ]
}
];

/* ================== INIT ================== */
let hunts = JSON.parse(localStorage.getItem("hunts") || "[]");

if (!localStorage.getItem("huntsInitialized")) {
  hunts = BASE_HUNTS.map(h => ({
    id: uid(),
    name: h.name,
    steps: h.clues.map(c => ({
      clue: c[0],
      location: c[1],
      code: randomCode()
    }))
  }));
  localStorage.setItem("hunts", JSON.stringify(hunts));
  localStorage.setItem("huntsInitialized","true");
}

const q = new URLSearchParams(location.search);
const app = document.getElementById("app");

/* ================== ROUTER ================== */
if (q.get("start")) startPage(q.get("start"));
else if (q.get("play")) play();
else if (q.get("print")) printPage(q.get("print"));
else home();

/* ================== HOME ================== */
function home(){
  app.innerHTML = `
    <h1>Scavenger Hunts</h1>
    ${hunts.map(h=>`
      <div>
        <h3>${h.name}</h3>
        <button onclick="location='?start=${h.id}'">‚ñ∂ Test Start</button>
        <button onclick="location='?print=${h.id}'">üñ® Print Instructions</button>
      </div>
    `).join("")}
  `;
}

/* ================== START PAGE ================== */
function startPage(id){
  const h = hunts.find(x=>x.id===id);
  app.innerHTML = `
    <h1>üéâ Welcome, Explorer!</h1>

    <p><strong>${h.name}</strong></p>

    <p>You have been invited on a special scavenger hunt!</p>

    <p>
      Around this place are hidden clues waiting to be found.<br>
      Each clue will lead you to the next one.
    </p>

    <p>When you find a clue, you might need to:</p>
    <ul>
      <li>Look carefully</li>
      <li>Think smart</li>
      <li>Scan a QR code</li>
      <li>Type in a secret number</li>
    </ul>

    <p>Don‚Äôt worry ‚Äî there are no wrong turns, just keep trying!</p>

    <p><strong>When you‚Äôre ready‚Ä¶</strong></p>

    <button onclick="location='?play=${id}&s=0'">‚ñ∂Ô∏è Start the Hunt</button>
  `;
}

/* ================== PLAY ================== */
function play(){
  const h = hunts.find(x=>x.id===q.get("play"));
  let s = parseInt(q.get("s"));
  if (s >= h.steps.length) {
    app.innerHTML = `<h2>üéâ Hunt Complete!</h2>`;
    return;
  }
  const step = h.steps[s];
  app.innerHTML = `
    <h2>${step.clue}</h2>
    <input id="ans" placeholder="Enter 6-digit code">
    <button onclick="check('${step.code}',${s})">Submit</button>
  `;
}

function check(code, s){
  const v = document.getElementById("ans").value.trim();
  if (v === code) {
    showOverlay("correct");
    setTimeout(()=>location=`?play=${q.get("play")}&s=${s+1}`,900);
  } else {
    showOverlay("wrong");
  }
}

function showOverlay(type){
  const el = document.getElementById(type);
  el.style.display="flex";
  setTimeout(()=>el.style.display="none",1000);
}

/* ================== PRINT ================== */
function printPage(id){
  const h = hunts.find(x=>x.id===id);

  app.innerHTML = `
    <h1>${h.name} ‚Äì Parent Instructions</h1>

    <div class="print-page">
      ${h.steps.map((s,i)=>`
        <div class="print-item">
          <strong>Clue ${i+1}:</strong> ${s.clue}<br>
          <strong>Location:</strong> ${s.location}<br>
          <strong>Code:</strong> ${s.code}<br>
          <canvas id="pqr${i}"></canvas>
          <div class="notes"></div>
        </div>
      `).join("")}
    </div>

    <div class="print-page">
      <h2>Cut-Out QR Codes</h2>
      ${h.steps.map((s,i)=>`
        <div class="print-item">
          <div class="qr-label">Clue ${i+1} ‚Äì ${s.location}</div>
          <canvas id="cqr${i}"></canvas>
        </div>
      `).join("")}
    </div>

    <button onclick="window.print()">Print</button>
  `;

  h.steps.forEach((s,i)=>{
    QRCode.toCanvas(document.getElementById("pqr"+i), s.code);
    QRCode.toCanvas(document.getElementById("cqr"+i), s.code);
  });
}
</script>

</body>
</html>