<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scavenger Hunt Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: system-ui, sans-serif; background:#f4f6f8; padding:20px; }
.card { max-width: 900px; margin:auto; background:#fff; padding:20px; border-radius:12px; }
.hunt { border:1px solid #ddd; padding:12px; border-radius:8px; margin-bottom:12px; }
button { padding:8px 14px; margin:4px; }
textarea, input { width:100%; padding:8px; margin:6px 0; }
hr { margin:20px 0; }
.print-clue { margin-bottom:30px; page-break-inside:avoid; }
.qr { margin:10px 0; }
.note-box { border:1px dashed #999; height:60px; }
.overlay {
  position:fixed; inset:0;
  background:rgba(0,0,0,.6);
  display:none; align-items:center; justify-content:center;
  color:white; font-size:24px; z-index:999;
}
@media print {
  button { display:none; }
  body { background:white; }
}
</style>
</head>

<body>
<div class="card" id="app"></div>
<div class="overlay" id="overlay">‚ùå Wrong Code ‚Äî Try Again</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
const app = document.getElementById("app");
const q = new URLSearchParams(location.search);

/* ---------- UTIL ---------- */
function uid(){ return Math.random().toString(36).slice(2,9); }
function code6(){ return Math.floor(100000 + Math.random()*900000).toString(); }
function save(){ localStorage.setItem("hunts", JSON.stringify(HUNTS)); }

/* ---------- DEFAULT HUNTS ---------- */
const DEFAULTS = {
  escape: {
    name:"Escape the House",
    intro:"Welcome! Your escape challenge begins now üè†",
    clues:[
      { clue:"I show your face but I‚Äôm not a photo.", location:"mirror" },
      { clue:"I have pages but no homework.", location:"bookshelf" },
      { clue:"I open wide but never talk.", location:"fridge" },
      { clue:"I go round and round but never get dizzy.", location:"washing machine" },
      { clue:"I have hands but no arms.", location:"clock" },
      { clue:"I hide your feet when you‚Äôre not home.", location:"shoe rack" },
      { clue:"I‚Äôm soft, comfy, and steal naps.", location:"couch" },
      { clue:"I light the dark but vanish by day.", location:"lamp" },
      { clue:"I‚Äôm full of secrets, you knock first.", location:"bedroom door" },
      { clue:"Final key ‚Äî your colour is RED", location:"red" }
    ],
    finish:"üéâ Congratulations! You escaped!"
  },

  fortnite: {
    name:"Fortnite IRL",
    intro:"Drop in!",
    clues:[
      { clue:"Where controllers rest.", location:"gaming desk" },
      { clue:"Where drinks recharge HP.", location:"fridge" },
      { clue:"Where shoes hide.", location:"entrance" },
      { clue:"Where tools live.", location:"garage" },
      { clue:"Family chill zone.", location:"lounge room" },
      { clue:"You can‚Äôt win without sleep.", location:"bed" },
      { clue:"Secrets behind doors.", location:"wardrobe" },
      { clue:"Devices come back to life.", location:"phone charger" },
      { clue:"High ground.", location:"stairs" },
      { clue:"Battles are watched.", location:"tv" },
      { clue:"Snacks vanish here.", location:"pantry" },
      { clue:"Victory Royale ‚Äî colour SILVER", location:"silver" }
    ],
    finish:"üèÜ VICTORY ROYALE!"
  },

  hacker: {
    name:"System Breach",
    intro:"SYSTEM ONLINE",
    clues:[
      { clue:"Controls all devices.", location:"router" },
      { clue:"Passwords written.", location:"notebook" },
      { clue:"Cold data storage.", location:"fridge" },
      { clue:"Commands typed.", location:"keyboard" },
      { clue:"One click changes all.", location:"mouse" },
      { clue:"Without this, system fails.", location:"power board" },
      { clue:"Clothes reset.", location:"laundry" },
      { clue:"Stored just in case.", location:"garage" },
      { clue:"Pixels form reality.", location:"monitor" },
      { clue:"Permission required.", location:"door" },
      { clue:"Locked storage.", location:"drawer" },
      { clue:"Tracks time.", location:"clock" },
      { clue:"User rests.", location:"bed" },
      { clue:"Admin access.", location:"desk" },
      { clue:"ROOT ACCESS ‚Äî colour GREEN", location:"green" }
    ],
    finish:"‚úÖ SYSTEM BREACHED"
  }
};

/* ---------- LOAD / LOCK CODES ---------- */
let HUNTS = JSON.parse(localStorage.getItem("hunts") || "null");
if(!HUNTS){
  HUNTS = {};
  for(const k in DEFAULTS){
    const h = DEFAULTS[k];
    h.clues = h.clues.map(c=>({
      clue:c.clue,
      location:c.location,
      code: code6()
    }));
    h.locked = true;
    HUNTS[k] = h;
  }
  save();
}

/* ---------- ROUTER ---------- */
if(q.get("play")) play();
else if(q.get("print")) printPage(q.get("print"));
else if(q.get("duplicate")) duplicate(q.get("duplicate"));
else home();

/* ---------- HOME ---------- */
function home(){
  app.innerHTML = `
    <h1>Scavenger Hunts</h1>
    <button onclick="alert('New hunt creation can be enabled next')">‚ûï Create New Hunt</button>
    <hr>
    ${Object.entries(HUNTS).map(([k,h])=>`
      <div class="hunt">
        <h3>${h.name}</h3>
        <button onclick="location='?play=${k}&s=0'">‚ñ∂ Start</button>
        <button onclick="location='?print=${k}'">üñ® Print Instructions</button>
        <button onclick="location='?duplicate=${k}'">üìÑ Duplicate</button>
      </div>
    `).join("")}
  `;
}

/* ---------- PLAY MODE ---------- */
function play(){
  const k = q.get("play");
  const h = HUNTS[k];
  const s = parseInt(q.get("s")||0);

  if(s===0) return show(h.intro);

  if(s<=h.clues.length){
    const c = h.clues[s-1];
    show(c.clue,true,c.code);
  } else {
    show(h.finish);
  }
}

function show(text,input=false,code=""){
  app.innerHTML = `
    <p>${text}</p>
    ${input?`
      <input id="ans" placeholder="Enter 6-digit code">
      <button onclick="check('${code}')">Submit</button>
    `:""}
  `;
}

function check(code){
  if(document.getElementById("ans").value.trim()===code){
    location=`?play=${q.get("play")}&s=${parseInt(q.get("s"))+1}`;
  } else {
    overlay.style.display="flex";
    setTimeout(()=>overlay.style.display="none",2000);
  }
}

/* ---------- PRINT ---------- */
function printPage(k){
  const h = HUNTS[k];
  app.innerHTML = `
    <h2>${h.name} ‚Äî Instructions</h2>
    ${h.clues.map((c,i)=>`
      <div class="print-clue">
        <strong>Clue ${i+1}</strong>
        <p>${c.clue}</p>
        <p><strong>Answer (Location):</strong> ${c.location}</p>
        <p><strong>Unlock Code:</strong> ${c.code}</p>
        <div class="qr" id="qr-${i}"></div>
        <div class="note-box"></div>
      </div>
    `).join("")}
    <button onclick="print()">üñ® Print</button>
    <button onclick="home()">‚¨Ö Back</button>
  `;

  h.clues.forEach((c,i)=>{
    QRCode.toCanvas(document.createElement("canvas"), c.code, { width:120 }, (err,canvas)=>{
      document.getElementById(`qr-${i}`).appendChild(canvas);
    });
  });
}

/* ---------- DUPLICATE ---------- */
function duplicate(k){
  const o = HUNTS[k];
  const nk = uid();
  HUNTS[nk] = {
    name: o.name + " (Copy " + new Date().toLocaleString() + ")",
    intro:o.intro,
    finish:o.finish,
    locked:true,
    clues:o.clues.map(c=>({
      clue:c.clue,
      location:c.location,
      code:code6()
    }))
  };
  save();
  home();
}
</script>
</body>
</html>
