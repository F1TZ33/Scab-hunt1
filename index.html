<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scavenger Hunt</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: system-ui, sans-serif; background:#f4f6f8; padding:20px; }
.card { max-width: 900px; margin:auto; background:#fff; padding:20px; border-radius:12px; }
.hunt { border:1px solid #ddd; padding:12px; border-radius:8px; margin-bottom:12px; }
button { padding:12px 18px; margin:6px 0; font-size:16px; }
textarea, input { width:100%; padding:8px; margin:6px 0; }
hr { margin:20px 0; }

.print-clue { margin-bottom:30px; page-break-inside:avoid; }
.qr { margin:10px 0; }
.note-box { border:1px dashed #999; height:60px; }

.cutout-page { page-break-before: always; }
.cutout-item {
  display:inline-block;
  width:45%;
  margin:10px 2%;
  text-align:center;
  page-break-inside:avoid;
  border:1px dashed #bbb;
  padding:10px;
}

.start-box {
  text-align:center;
  font-size:18px;
}
.start-box h1 { font-size:32px; }

.overlay {
  position:fixed; inset:0;
  background:rgba(0,0,0,.6);
  display:none; align-items:center; justify-content:center;
  color:white; font-size:24px; z-index:999;
}

@media print {
  button { display:none; }
  body { background:white; }
}
</style>
</head>

<body>
<div class="card" id="app"></div>
<div class="overlay" id="overlay">‚ùå Wrong Code ‚Äî Try Again</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
const app = document.getElementById("app");
const q = new URLSearchParams(location.search);

function uid(){ return Math.random().toString(36).slice(2,9); }
function code6(){ return Math.floor(100000 + Math.random()*900000).toString(); }
function save(){ localStorage.setItem("hunts", JSON.stringify(HUNTS)); }

/* ---------- DEFAULT HUNTS ---------- */
const DEFAULTS = {
  escape:{
    name:"Escape the House",
    intro:"Welcome! Your escape challenge begins now üè†",
    clues:[
      { clue:"I show your face but I‚Äôm not a photo.", location:"Mirror" },
      { clue:"I have pages but no homework.", location:"Bookshelf" },
      { clue:"I open wide but never talk.", location:"Fridge" },
      { clue:"I go round and round but never get dizzy.", location:"Washing Machine" },
      { clue:"I have hands but no arms.", location:"Clock" },
      { clue:"I hide your feet when you‚Äôre not home.", location:"Shoe Rack" },
      { clue:"I‚Äôm soft, comfy, and steal naps.", location:"Couch" },
      { clue:"I light the dark but vanish by day.", location:"Lamp" },
      { clue:"I‚Äôm full of secrets, you knock first.", location:"Bedroom Door" },
      { clue:"Final key ‚Äî your colour is RED", location:"RED" }
    ],
    finish:"üéâ Congratulations! You escaped!"
  },

  fortnite:{
    name:"Fortnite IRL",
    intro:"Drop in!",
    clues:[
      { clue:"Where controllers rest.", location:"Gaming Desk" },
      { clue:"Where drinks recharge HP.", location:"Fridge" },
      { clue:"Where shoes hide.", location:"Entrance" },
      { clue:"Where tools live.", location:"Garage" },
      { clue:"Family chill zone.", location:"Lounge Room" },
      { clue:"You can‚Äôt win without sleep.", location:"Bed" },
      { clue:"Secrets behind doors.", location:"Wardrobe" },
      { clue:"Devices come back to life.", location:"Phone Charger" },
      { clue:"High ground.", location:"Stairs" },
      { clue:"Battles are watched.", location:"TV" },
      { clue:"Snacks vanish here.", location:"Pantry" },
      { clue:"Victory Royale ‚Äî colour SILVER", location:"SILVER" }
    ],
    finish:"üèÜ VICTORY ROYALE!"
  },

  hacker:{
    name:"System Breach",
    intro:"SYSTEM ONLINE",
    clues:[
      { clue:"Controls all devices.", location:"Router" },
      { clue:"Passwords written.", location:"Notebook" },
      { clue:"Cold data storage.", location:"Fridge" },
      { clue:"Commands typed.", location:"Keyboard" },
      { clue:"One click changes all.", location:"Mouse" },
      { clue:"Without this, system fails.", location:"Power Board" },
      { clue:"Clothes reset.", location:"Laundry" },
      { clue:"Stored just in case.", location:"Garage" },
      { clue:"Pixels form reality.", location:"Monitor" },
      { clue:"Permission required.", location:"Door" },
      { clue:"Locked storage.", location:"Drawer" },
      { clue:"Tracks time.", location:"Clock" },
      { clue:"User rests.", location:"Bed" },
      { clue:"Admin access.", location:"Desk" },
      { clue:"ROOT ACCESS ‚Äî colour GREEN", location:"GREEN" }
    ],
    finish:"‚úÖ SYSTEM BREACHED"
  }
};

/* ---------- LOAD / LOCK CODES ---------- */
let HUNTS = JSON.parse(localStorage.getItem("hunts") || "null");
if(!HUNTS){
  HUNTS = {};
  for(const k in DEFAULTS){
    const h = DEFAULTS[k];
    h.clues = h.clues.map(c=>({
      clue:c.clue,
      location:c.location,
      code:code6()
    }));
    HUNTS[k] = h;
  }
  save();
}

/* ---------- ROUTER ---------- */
if(q.get("start")) startPage(q.get("start"));
else if(q.get("play")) play();
else if(q.get("print")) printPage(q.get("print"));
else home();

/* ---------- START PAGE ---------- */
function startPage(k){
  app.innerHTML = `
    <div class="start-box">
      <h1>üéâ Welcome, Explorer!</h1>
      <p>You have been invited on a <strong>special scavenger hunt</strong>!</p>
      <p>Around this place are <strong>hidden clues</strong> waiting to be found.<br>
      Each clue will lead you to the next one.</p>

      <p>When you find a clue, you might need to:</p>
      <ul style="list-style:none;padding:0">
        <li>üëÄ Look carefully</li>
        <li>üß† Think smart</li>
        <li>üì∑ Scan a QR code</li>
        <li>üî¢ Type a secret number</li>
      </ul>

      <p>Don‚Äôt worry ‚Äî there are <strong>no wrong turns</strong>, just keep trying!</p>
      <button onclick="location='?play=${k}&s=1'">‚ñ∂ Start the Hunt</button>
    </div>
  `;
}

/* ---------- HOME ---------- */
function home(){
  app.innerHTML = `
    <h1>Scavenger Hunts</h1>
    ${Object.entries(HUNTS).map(([k,h])=>`
      <div class="hunt">
        <h3>${h.name}</h3>
        <button onclick="location='?start=${k}'">üì± Start QR</button>
        <button onclick="location='?print=${k}'">üñ® Print Instructions</button>
      </div>
    `).join("")}
  `;
}

/* ---------- PLAY ---------- */
function play(){
  const k = q.get("play");
  const h = HUNTS[k];
  const s = parseInt(q.get("s")||0);

  if(s<=h.clues.length){
    const c = h.clues[s-1];
    show(c.clue,true,c.code);
  } else {
    show(h.finish);
  }
}

function show(text,input=false,code=""){
  app.innerHTML = `
    <p>${text}</p>
    ${input?`
      <input id="ans" placeholder="Enter 6-digit code">
      <button onclick="check('${code}')">Submit</button>
    `:""}
  `;
}

function check(code){
  if(document.getElementById("ans").value.trim()===code){
    location=`?play=${q.get("play")}&s=${parseInt(q.get("s"))+1}`;
  } else {
    overlay.style.display="flex";
    setTimeout(()=>overlay.style.display="none",2000);
  }
}

/* ---------- PRINT ---------- */
function printPage(k){
  const h = HUNTS[k];
  app.innerHTML = `
    <h2>${h.name} ‚Äî Instructions</h2>
    ${h.clues.map((c,i)=>`
      <div class="print-clue">
        <strong>Clue ${i+1}</strong>
        <p>${c.clue}</p>
        <p><strong>Answer (Location):</strong> ${c.location}</p>
        <p><strong>Unlock Code:</strong> ${c.code}</p>
        <div class="qr" id="qr-main-${i}"></div>
        <div class="note-box"></div>
      </div>
    `).join("")}

    <div class="cutout-page">
      <h2>Cut-Out QR Codes</h2>
      ${h.clues.map((c,i)=>`
        <div class="cutout-item">
          <strong>Clue ${i+1}</strong><br>${c.location}
          <div class="qr" id="qr-cut-${i}"></div>
        </div>
      `).join("")}
    </div>

    <button onclick="print()">üñ® Print</button>
    <button onclick="home()">‚¨Ö Back</button>
  `;

  h.clues.forEach((c,i)=>{
    QRCode.toCanvas(document.createElement("canvas"), c.code, { width:120 }, (e,cv)=>{
      document.getElementById(`qr-main-${i}`).appendChild(cv);
      document.getElementById(`qr-cut-${i}`).appendChild(cv.cloneNode(true));
    });
  });
}
</script>
</body>
</html>